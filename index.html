<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="icon" type="image/png" href="image.png" />
  <link rel="apple-touch-icon" href="image.png" />
  <title>1 åˆ†é’Ÿç¦…å®š</title>
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      min-height: 100vh;
      min-height: -webkit-fill-available;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui;
      background: radial-gradient(circle at top, #243b53, #020617);
      color: #e5e7eb;
      padding: 16px;
      overflow-x: hidden;
    }
    html {
      height: -webkit-fill-available;
    }
    .card {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 24px;
      padding: 32px 24px;
      width: 100%;
      max-width: 360px;
      text-align: center;
      box-shadow: 0 20px 45px rgba(0,0,0,0.4);
      backdrop-filter: blur(16px);
    }
    h1 {
      font-size: 22px;
      margin-bottom: 12px;
      line-height: 1.3;
    }
    p {
      font-size: 15px;
      line-height: 1.6;
      color: #9ca3af;
      margin-bottom: 20px;
    }
    button {
      margin-top: 8px;
      padding: 12px 24px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      cursor: pointer;
      background: #22c55e;
      color: #022c22;
      font-weight: 500;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s;
      -webkit-appearance: none;
      touch-action: manipulation;
      min-height: 44px;
    }
    button:active {
      transform: scale(0.98);
      background: #16a34a;
    }
    @media (hover: hover) {
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(34,197,94,0.4);
        background: #16a34a;
      }
    }
    .hidden {
      display: none;
    }
    .breath-circle {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      border: 2px solid rgba(148,163,184,0.6);
      margin: 32px auto 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 4s ease-in-out, opacity 1s ease-in-out;
      position: relative;
    }
    @media (max-width: 380px) {
      .breath-circle {
        width: 140px;
        height: 140px;
      }
    }
    .breath-circle-inner {
      width: 40%;
      height: 40%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #4ade80, #16a34a);
      opacity: 0.9;
      transition: transform 4s ease-in-out, opacity 1s ease-in-out;
    }
    .phase-text {
      font-size: 18px;
      margin-bottom: 8px;
      margin-top: 0;
      font-weight: 500;
    }
    .hint-text {
      font-size: 14px;
      color: #9ca3af;
      line-height: 1.5;
      padding: 0 8px;
    }
    .duration-selector {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .duration-btn {
      padding: 8px 16px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.3);
      background: transparent;
      color: #9ca3af;
      font-size: 14px;
      min-height: auto;
      margin: 0;
      transition: all 0.2s;
    }
    .duration-btn.active {
      background: rgba(34,197,94,0.15);
      border-color: #22c55e;
      color: #22c55e;
    }
    .duration-btn:active {
      transform: scale(0.95);
    }
    .fullscreen-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      padding: 0;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148,163,184,0.3);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.2s;
      backdrop-filter: blur(8px);
    }
    .fullscreen-btn:hover {
      background: rgba(15, 23, 42, 0.8);
      border-color: #22c55e;
    }
    .fullscreen-btn svg {
      width: 20px;
      height: 20px;
      fill: #9ca3af;
    }
    .fullscreen-btn:hover svg {
      fill: #22c55e;
    }
    .fullscreen-option {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
      font-size: 13px;
      color: #9ca3af;
    }
    .fullscreen-option input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #22c55e;
    }
    .fullscreen-option label {
      cursor: pointer;
      user-select: none;
    }
    .share-btn {
      background: transparent;
      border: 1px solid rgba(148,163,184,0.3);
      color: #9ca3af;
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .share-btn:hover {
      border-color: #22c55e;
      color: #22c55e;
      background: rgba(34,197,94,0.1);
    }
    .share-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }
    .share-toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(34,197,94,0.9);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      z-index: 2000;
    }
    .share-toast.show {
      opacity: 1;
    }
    .share-card-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      padding: 20px;
    }
    .share-card-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    .share-card {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border-radius: 20px;
      padding: 32px 24px;
      max-width: 400px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      position: relative;
      border: 1px solid rgba(148,163,184,0.2);
    }
    .share-card-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(148,163,184,0.1);
      border-radius: 8px;
      color: #9ca3af;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all 0.2s;
      padding: 0;
      min-height: auto;
      margin: 0;
    }
    .share-card-close:hover {
      background: rgba(148,163,184,0.2);
      color: #e5e7eb;
      transform: none;
    }
    .share-card-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px;
      background: radial-gradient(circle at 30% 20%, #4ade80, #16a34a);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
    }
    .share-card h2 {
      font-size: 20px;
      margin-bottom: 12px;
      color: #e5e7eb;
    }
    .share-card-text {
      font-size: 15px;
      line-height: 1.6;
      color: #9ca3af;
      margin-bottom: 16px;
      padding: 16px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
      border: 1px dashed rgba(148,163,184,0.3);
    }
    .share-card-url {
      font-size: 13px;
      color: #22c55e;
      margin-top: 8px;
      word-break: break-all;
    }
    .share-card-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    .share-card-actions button {
      flex: 1;
      margin: 0;
    }
  </style>
</head>
<body>
  <button class="fullscreen-btn" id="fullscreen-btn" title="å…¨å±">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
    </svg>
  </button>

  <div class="card">
    <div id="start-view">
      <h1>å…ˆåœä¸€ä¼šå„¿</h1>
      <p>å¦‚æœä½ ç°åœ¨æœ‰ç‚¹çƒ¦èºï¼Œè¯•ç€è·Ÿç€å‘¼å¸ï¼Œä¸åšåˆ«çš„äº‹æƒ…ã€‚</p>
      <div class="duration-selector">
        <button class="duration-btn active" data-duration="1">1 åˆ†é’Ÿ</button>
        <button class="duration-btn" data-duration="3">3 åˆ†é’Ÿ</button>
        <button class="duration-btn" data-duration="5">5 åˆ†é’Ÿ</button>
        <button class="duration-btn" data-duration="15">15 åˆ†é’Ÿ</button>
        <button class="duration-btn" data-duration="30">30 åˆ†é’Ÿ</button>
      </div>
      <button id="start-btn">å¼€å§‹é™å¿ƒ</button>
      <div class="fullscreen-option">
        <input type="checkbox" id="auto-fullscreen" checked />
        <label for="auto-fullscreen">å¯åŠ¨æ—¶è‡ªåŠ¨å…¨å±</label>
      </div>
    </div>

    <div id="session-view" class="hidden">
      <div class="breath-circle" id="breath-circle">
        <div class="breath-circle-inner" id="breath-inner"></div>
      </div>
      <div class="phase-text" id="phase-text">å‡†å¤‡å¼€å§‹</div>
      <div class="hint-text" id="hint-text">
        è·Ÿç€åœ†çš„èŠ‚å¥å¸æ°”ã€åœç•™ã€å‘¼æ°”ã€‚è·‘ç¥äº†ä¹Ÿæ²¡å…³ç³»ã€‚
      </div>
    </div>

    <div id="end-view" class="hidden">
      <h1>è°¢è°¢ä½ é™ªè‡ªå·±å®‰é™äº†ä¸€ä¼šå„¿</h1>
      <p>å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥å†æ¥ä¸€æ¬¡ï¼Œåªä¸ºè‡ªå·±ã€‚</p>
      <button id="again-btn">å†æ¥ä¸€æ¬¡</button>
      <button id="share-btn" class="share-btn">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
        </svg>
        åˆ†äº«ç»™æœ‹å‹
      </button>
    </div>
  
  <div id="share-toast" class="share-toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>

  <div id="share-card-overlay" class="share-card-overlay">
    <div class="share-card">
      <button class="share-card-close" id="share-card-close">Ã—</button>
      <div class="share-card-icon">ğŸ§˜</div>
      <h2>åˆ†äº«ç»™æœ‹å‹</h2>
      <div class="share-card-text" id="share-card-text">
        æˆ‘åˆšåˆšåœ¨ Zen ç¦…å®šå¹³é™äº† 1 åˆ†é’Ÿï¼Œä½ ä¹Ÿæ¥è¯•è¯•å§ã€‚
        <div class="share-card-url" id="share-card-url"></div>
      </div>
      <div class="share-card-actions">
        <button id="copy-share-btn">å¤åˆ¶æ–‡æ¡ˆ</button>
        <button id="native-share-btn" style="display: none;">ç³»ç»Ÿåˆ†äº«</button>
      </div>
    </div>
  </div>
  </div>

  <audio id="bgMusic" loop>
    <source src="M5000010qS6y2wh8a0.mp3" type="audio/mpeg">
  </audio>

  <script>
    const startView = document.getElementById('start-view');
    const sessionView = document.getElementById('session-view');
    const endView = document.getElementById('end-view');

    const startBtn = document.getElementById('start-btn');
    const againBtn = document.getElementById('again-btn');

    const phaseText = document.getElementById('phase-text');
    const hintText = document.getElementById('hint-text');
    const circle = document.getElementById('breath-circle');
    const inner = document.getElementById('breath-inner');

    const bgMusic = document.getElementById('bgMusic');

    let timer = null;
    let selectedDuration = parseInt(localStorage.getItem('zenDuration')) || 1; // ä»ç¼“å­˜è¯»å–ï¼Œé»˜è®¤ 1 åˆ†é’Ÿ

    // è‡ªåŠ¨å…¨å±é€‰é¡¹
    const autoFullscreenCheckbox = document.getElementById('auto-fullscreen');
    const autoFullscreenEnabled = localStorage.getItem('autoFullscreen') !== 'false'; // é»˜è®¤å¼€å¯
    autoFullscreenCheckbox.checked = autoFullscreenEnabled;

    autoFullscreenCheckbox.addEventListener('change', (e) => {
      localStorage.setItem('autoFullscreen', e.target.checked);
    });

    // æ—¶é•¿é€‰æ‹©æŒ‰é’®
    const durationBtns = document.querySelectorAll('.duration-btn');
    
    // åˆå§‹åŒ–ï¼šæ ¹æ®ç¼“å­˜è®¾ç½®é€‰ä¸­çŠ¶æ€
    durationBtns.forEach(btn => {
      if (parseInt(btn.dataset.duration) === selectedDuration) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });

    // ç‚¹å‡»æ—¶é•¿æŒ‰é’®
    durationBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        durationBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedDuration = parseInt(btn.dataset.duration);
        localStorage.setItem('zenDuration', selectedDuration); // ä¿å­˜åˆ°ç¼“å­˜
      });
    });

    function startSession() {
      startView.classList.add('hidden');
      endView.classList.add('hidden');
      sessionView.classList.remove('hidden');

      // æ ¹æ®ç”¨æˆ·è®¾ç½®å†³å®šæ˜¯å¦è‡ªåŠ¨è¿›å…¥å…¨å±
      if (autoFullscreenCheckbox.checked && !document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log('å…¨å±å¤±è´¥:', err);
        });
      }

      // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
      bgMusic.play().catch(err => {
        console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', err);
      });

      let totalSeconds = 0;
      let phaseIndex = 0;

      // 4-7-8 å‘¼å¸æ³•
      const phases = [
        { label: 'å¸æ°”', hint: 'ç”¨é¼»å­ç¼“æ…¢å¸æ°”ï¼Œæ„Ÿå—èƒ¸å£å’Œè…¹éƒ¨è½»è½»æŠ¬èµ·ã€‚', duration: 4, scale: 1.4 },
        { label: 'å±æ¯', hint: 'ä¿æŒå‘¼å¸ï¼Œä¸éœ€è¦ç”¨åŠ›ï¼Œæ„Ÿå—èº«ä½“çš„å¹³é™ã€‚', duration: 7, scale: 1.4 },
        { label: 'å‘¼æ°”', hint: 'ç”¨å˜´ç¼“æ…¢å‘¼å‡ºï¼Œè®©è‚©è†€è‡ªç„¶æ”¾æ¾ä¸‹æ¥ã€‚', duration: 8, scale: 0.9 },
      ];

      function applyPhase(phase) {
        phaseText.textContent = phase.label;
        hintText.textContent = phase.hint;
        circle.style.transform = `scale(${phase.scale})`;
        inner.style.transform = `scale(${phase.scale})`;
      }

      // åˆå§‹ä¸€å°æ®µå‡†å¤‡æ—¶é—´
      phaseText.textContent = 'å‡†å¤‡å¼€å§‹';
      hintText.textContent = 'è½»è½»é—­ä¸Šçœ¼ç›æˆ–å‚ä¸‹è§†çº¿ï¼Œç­‰ä¸€ä¼šå„¿ã€‚';

      if (timer) clearInterval(timer);

      const targetSeconds = selectedDuration * 60;

      function runBreathCycle() {
        const phase = phases[phaseIndex];
        applyPhase(phase);
        totalSeconds += phase.duration;

        // è¾¾åˆ°ç›®æ ‡æ—¶é•¿ç»“æŸ
        if (totalSeconds >= targetSeconds) {
          endSession();
          return;
        }

        // åˆ‡ä¸‹ä¸€é˜¶æ®µ
        phaseIndex = (phaseIndex + 1) % phases.length;
        
        // æ ¹æ®å½“å‰é˜¶æ®µçš„æ—¶é•¿è®¾ç½®ä¸‹ä¸€æ¬¡æ‰§è¡Œ
        setTimeout(runBreathCycle, phase.duration * 1000);
      }

      setTimeout(() => {
        runBreathCycle();
      }, 3750);
    }

    function endSession() {
      sessionView.classList.add('hidden');
      endView.classList.remove('hidden');
      
      // è®°å½•å®Œæˆçš„æ—¶é•¿
      completedDuration = selectedDuration;
      
      // åœæ­¢èƒŒæ™¯éŸ³ä¹
      bgMusic.pause();
      bgMusic.currentTime = 0;
    }

    startBtn.addEventListener('click', startSession);
    againBtn.addEventListener('click', startSession);

    // åˆ†äº«åŠŸèƒ½
    const shareBtn = document.getElementById('share-btn');
    const shareToast = document.getElementById('share-toast');
    const shareCardOverlay = document.getElementById('share-card-overlay');
    const shareCardClose = document.getElementById('share-card-close');
    const shareCardText = document.getElementById('share-card-text');
    const shareCardUrl = document.getElementById('share-card-url');
    const copyShareBtn = document.getElementById('copy-share-btn');
    const nativeShareBtn = document.getElementById('native-share-btn');
    let completedDuration = 0;

    // æ£€æµ‹æ˜¯å¦æ”¯æŒåŸç”Ÿåˆ†äº«
    if (navigator.share) {
      nativeShareBtn.style.display = 'block';
    }

    shareBtn.addEventListener('click', () => {
      const minutes = completedDuration || selectedDuration;
      const url = window.location.href;
      const text = `æˆ‘åˆšåˆšåœ¨ Zen ç¦…å®šå¹³é™äº† ${minutes} åˆ†é’Ÿï¼Œä½ ä¹Ÿæ¥è¯•è¯•å§ã€‚`;
      
      // æ›´æ–°å¡ç‰‡å†…å®¹
      shareCardText.innerHTML = `${text}<div class="share-card-url">${url}</div>`;
      
      // æ˜¾ç¤ºåˆ†äº«å¡ç‰‡
      shareCardOverlay.classList.add('show');
    });

    // å…³é—­åˆ†äº«å¡ç‰‡
    shareCardClose.addEventListener('click', () => {
      shareCardOverlay.classList.remove('show');
    });

    shareCardOverlay.addEventListener('click', (e) => {
      if (e.target === shareCardOverlay) {
        shareCardOverlay.classList.remove('show');
      }
    });

    // å¤åˆ¶æ–‡æ¡ˆ
    copyShareBtn.addEventListener('click', () => {
      const minutes = completedDuration || selectedDuration;
      const shareText = `æˆ‘åˆšåˆšåœ¨ Zen ç¦…å®šå¹³é™äº† ${minutes} åˆ†é’Ÿï¼Œä½ ä¹Ÿæ¥è¯•è¯•å§ã€‚\n${window.location.href}`;
      copyToClipboard(shareText);
    });

    // åŸç”Ÿåˆ†äº«
    nativeShareBtn.addEventListener('click', () => {
      const minutes = completedDuration || selectedDuration;
      const shareText = `æˆ‘åˆšåˆšåœ¨ Zen ç¦…å®šå¹³é™äº† ${minutes} åˆ†é’Ÿï¼Œä½ ä¹Ÿæ¥è¯•è¯•å§ã€‚`;
      
      navigator.share({
        title: 'Zen ç¦…å®š',
        text: shareText,
        url: window.location.href,
      }).catch(err => {
        console.log('åˆ†äº«å¤±è´¥:', err);
      });
    });

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast();
        shareCardOverlay.classList.remove('show');
      }).catch(err => {
        console.log('å¤åˆ¶å¤±è´¥:', err);
        // é™çº§æ–¹æ¡ˆ
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showToast();
        shareCardOverlay.classList.remove('show');
      });
    }

    function showToast() {
      shareToast.classList.add('show');
      setTimeout(() => {
        shareToast.classList.remove('show');
      }, 2000);
    }

    // å…¨å±åŠŸèƒ½
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        // è¿›å…¥å…¨å±
        document.documentElement.requestFullscreen().catch(err => {
          console.log('å…¨å±å¤±è´¥:', err);
        });
      } else {
        // é€€å‡ºå…¨å±
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }

    // æ›´æ–°å…¨å±æŒ‰é’®å›¾æ ‡
    function updateFullscreenIcon() {
      const svg = fullscreenBtn.querySelector('svg');
      if (document.fullscreenElement) {
        // é€€å‡ºå…¨å±å›¾æ ‡
        svg.innerHTML = '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';
      } else {
        // è¿›å…¥å…¨å±å›¾æ ‡
        svg.innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';
      }
    }

    fullscreenBtn.addEventListener('click', toggleFullscreen);
    document.addEventListener('fullscreenchange', updateFullscreenIcon);
  </script>
</body>
</html>
