<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="icon" type="image/png" href="image.png" />
  <link rel="apple-touch-icon" href="image.png" />
  <title>1 分钟禅定</title>
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      min-height: 100vh;
      min-height: -webkit-fill-available;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui;
      background: radial-gradient(circle at top, #243b53, #020617);
      color: #e5e7eb;
      padding: 16px;
      overflow-x: hidden;
    }
    html {
      height: -webkit-fill-available;
    }
    .card {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 24px;
      padding: 32px 24px;
      width: 100%;
      max-width: 360px;
      text-align: center;
      box-shadow: 0 20px 45px rgba(0,0,0,0.4);
      backdrop-filter: blur(16px);
    }
    h1 {
      font-size: 22px;
      margin-bottom: 12px;
      line-height: 1.3;
    }
    p {
      font-size: 15px;
      line-height: 1.6;
      color: #9ca3af;
      margin-bottom: 20px;
    }
    button {
      margin-top: 8px;
      padding: 12px 24px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      cursor: pointer;
      background: #22c55e;
      color: #022c22;
      font-weight: 500;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s;
      -webkit-appearance: none;
      touch-action: manipulation;
      min-height: 44px;
    }
    button:active {
      transform: scale(0.98);
      background: #16a34a;
    }
    @media (hover: hover) {
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(34,197,94,0.4);
        background: #16a34a;
      }
    }
    .hidden {
      display: none;
    }
    .breath-circle {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      border: 2px solid rgba(148,163,184,0.6);
      margin: 32px auto 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 4s ease-in-out, opacity 1s ease-in-out;
      position: relative;
    }
    @media (max-width: 380px) {
      .breath-circle {
        width: 140px;
        height: 140px;
      }
    }
    .breath-circle-inner {
      width: 40%;
      height: 40%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #4ade80, #16a34a);
      opacity: 0.9;
      transition: transform 4s ease-in-out, opacity 1s ease-in-out;
    }
    .phase-text {
      font-size: 18px;
      margin-bottom: 8px;
      margin-top: 0;
      font-weight: 500;
    }
    .hint-text {
      font-size: 14px;
      color: #9ca3af;
      line-height: 1.5;
      padding: 0 8px;
    }
    .duration-selector {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .duration-btn {
      padding: 8px 16px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.3);
      background: transparent;
      color: #9ca3af;
      font-size: 14px;
      min-height: auto;
      margin: 0;
      transition: all 0.2s;
    }
    .duration-btn.active {
      background: rgba(34,197,94,0.15);
      border-color: #22c55e;
      color: #22c55e;
    }
    .duration-btn:active {
      transform: scale(0.95);
    }
    .fullscreen-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      padding: 0;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148,163,184,0.3);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.2s;
      backdrop-filter: blur(8px);
    }
    .fullscreen-btn:hover {
      background: rgba(15, 23, 42, 0.8);
      border-color: #22c55e;
    }
    .fullscreen-btn svg {
      width: 20px;
      height: 20px;
      fill: #9ca3af;
    }
    .fullscreen-btn:hover svg {
      fill: #22c55e;
    }
    .fullscreen-option {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
      font-size: 13px;
      color: #9ca3af;
    }
    .fullscreen-option input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #22c55e;
    }
    .fullscreen-option label {
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
  <button class="fullscreen-btn" id="fullscreen-btn" title="全屏">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
    </svg>
  </button>

  <div class="card">
    <div id="start-view">
      <h1>先停一会儿</h1>
      <p>如果你现在有点烦躁，试着跟着呼吸，不做别的事情。</p>
      <div class="duration-selector">
        <button class="duration-btn active" data-duration="1">1 分钟</button>
        <button class="duration-btn" data-duration="3">3 分钟</button>
        <button class="duration-btn" data-duration="5">5 分钟</button>
        <button class="duration-btn" data-duration="15">15 分钟</button>
        <button class="duration-btn" data-duration="30">30 分钟</button>
      </div>
      <button id="start-btn">开始静心</button>
      <div class="fullscreen-option">
        <input type="checkbox" id="auto-fullscreen" checked />
        <label for="auto-fullscreen">启动时自动全屏</label>
      </div>
    </div>

    <div id="session-view" class="hidden">
      <div class="breath-circle" id="breath-circle">
        <div class="breath-circle-inner" id="breath-inner"></div>
      </div>
      <div class="phase-text" id="phase-text">准备开始</div>
      <div class="hint-text" id="hint-text">
        跟着圆的节奏吸气、停留、呼气。跑神了也没关系。
      </div>
    </div>

    <div id="end-view" class="hidden">
      <h1>谢谢你陪自己安静了一会儿</h1>
      <p>如果你愿意，可以再来一次，只为自己。</p>
      <button id="again-btn">再来一次</button>
    </div>
  </div>

  <audio id="bgMusic" loop>
    <source src="M5000010qS6y2wh8a0.mp3" type="audio/mpeg">
  </audio>

  <script>
    const startView = document.getElementById('start-view');
    const sessionView = document.getElementById('session-view');
    const endView = document.getElementById('end-view');

    const startBtn = document.getElementById('start-btn');
    const againBtn = document.getElementById('again-btn');

    const phaseText = document.getElementById('phase-text');
    const hintText = document.getElementById('hint-text');
    const circle = document.getElementById('breath-circle');
    const inner = document.getElementById('breath-inner');

    const bgMusic = document.getElementById('bgMusic');

    let timer = null;
    let selectedDuration = parseInt(localStorage.getItem('zenDuration')) || 1; // 从缓存读取，默认 1 分钟

    // 自动全屏选项
    const autoFullscreenCheckbox = document.getElementById('auto-fullscreen');
    const autoFullscreenEnabled = localStorage.getItem('autoFullscreen') !== 'false'; // 默认开启
    autoFullscreenCheckbox.checked = autoFullscreenEnabled;

    autoFullscreenCheckbox.addEventListener('change', (e) => {
      localStorage.setItem('autoFullscreen', e.target.checked);
    });

    // 时长选择按钮
    const durationBtns = document.querySelectorAll('.duration-btn');
    
    // 初始化：根据缓存设置选中状态
    durationBtns.forEach(btn => {
      if (parseInt(btn.dataset.duration) === selectedDuration) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });

    // 点击时长按钮
    durationBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        durationBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedDuration = parseInt(btn.dataset.duration);
        localStorage.setItem('zenDuration', selectedDuration); // 保存到缓存
      });
    });

    function startSession() {
      startView.classList.add('hidden');
      endView.classList.add('hidden');
      sessionView.classList.remove('hidden');

      // 根据用户设置决定是否自动进入全屏
      if (autoFullscreenCheckbox.checked && !document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log('全屏失败:', err);
        });
      }

      // 播放背景音乐
      bgMusic.play().catch(err => {
        console.log('音乐播放失败:', err);
      });

      let totalSeconds = 0;
      let phaseIndex = 0;

      const phases = [
        { label: '吸气', hint: '缓慢把气吸满，感受胸口和腹部轻轻抬起。', scale: 1.4 },
        { label: '停留', hint: '保持片刻，不需要用力，感受呼吸停顿。', scale: 1.4 },
        { label: '呼气', hint: '慢慢把气呼出，让肩膀自然放松下来。', scale: 0.9 },
        { label: '停留', hint: '短暂停留，准备下一次呼吸。', scale: 0.9 },
      ];

      function applyPhase(phase) {
        phaseText.textContent = phase.label;
        hintText.textContent = phase.hint;
        circle.style.transform = `scale(${phase.scale})`;
        inner.style.transform = `scale(${phase.scale})`;
      }

      // 初始一小段准备时间
      phaseText.textContent = '准备开始';
      hintText.textContent = '轻轻闭上眼睛或垂下视线，等一会儿。';

      if (timer) clearInterval(timer);

      const targetSeconds = selectedDuration * 60;

      setTimeout(() => {
        applyPhase(phases[phaseIndex]);

        timer = setInterval(() => {
          totalSeconds += 4; // 每个阶段 4 秒

          // 切下一阶段
          phaseIndex = (phaseIndex + 1) % phases.length;
          applyPhase(phases[phaseIndex]);

          // 达到目标时长结束
          if (totalSeconds >= targetSeconds) {
            clearInterval(timer);
            endSession();
          }
        }, 4000);
      }, 1500);
    }

    function endSession() {
      sessionView.classList.add('hidden');
      endView.classList.remove('hidden');
      
      // 停止背景音乐
      bgMusic.pause();
      bgMusic.currentTime = 0;
    }

    startBtn.addEventListener('click', startSession);
    againBtn.addEventListener('click', startSession);

    // 全屏功能
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        // 进入全屏
        document.documentElement.requestFullscreen().catch(err => {
          console.log('全屏失败:', err);
        });
      } else {
        // 退出全屏
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }

    // 更新全屏按钮图标
    function updateFullscreenIcon() {
      const svg = fullscreenBtn.querySelector('svg');
      if (document.fullscreenElement) {
        // 退出全屏图标
        svg.innerHTML = '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';
      } else {
        // 进入全屏图标
        svg.innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';
      }
    }

    fullscreenBtn.addEventListener('click', toggleFullscreen);
    document.addEventListener('fullscreenchange', updateFullscreenIcon);
  </script>
</body>
</html>
